# 控制台终端使用说明

## 概述

控制台终端为MyOS VM系统提供了完整的用户交互界面，支持从文件加载payload并通过统一接口控制多架构VM的执行。

## 主要功能

### 1. VM管理功能
- 创建不同架构的VM实例（x86/arm/x64）
- 从二进制文件加载payload
- 控制VM的启动、暂停、恢复、停止
- 执行指定步数的指令
- 查看VM详细信息和寄存器状态

### 2. 调度器集成
- 启动/停止调度器
- 将VM添加到调度队列
- 静态核心绑定
- 查看调度器统计信息

### 3. 性能监控
- 监控VM执行时间
- 统计指令执行数量
- 生成性能报告

## 使用方法

### 启动系统
```bash
# 编译项目
mkdir build && cd build
cmake ..
cmake --build .

# 运行程序
./MyOS_VM.exe
```

程序启动后会询问是否运行自动化测试，输入'y'可执行预设的测试流程。

### 基本命令

#### 系统命令
```
help                    # 显示帮助信息
status                  # 显示系统状态
exit                    # 退出终端
```

#### VM管理命令
```
# 创建VM
vm create x86 payload.bin    # 创建x86 VM
vm create arm payload.bin    # 创建ARM VM  
vm create x64 payload.bin    # 创建x64 VM

# VM控制
vm list                      # 列出所有VM
vm start <id>               # 启动指定VM
vm stop <id>                # 停止指定VM
vm pause <id>               # 暂停指定VM
vm resume <id>              # 恢复指定VM
vm run <id> <steps>         # 运行指定步数
vm info <id>                # 查看VM信息
```

#### 调度器命令
```
sched start                 # 启动调度器
sched stop                  # 停止调度器
sched add <id> <priority>   # 添加VM到调度队列
sched bind <id> <core>      # 绑定VM到指定核心
sched unbind <id>           # 解绑VM核心绑定
sched stats                 # 查看调度器统计
```

#### 性能监控命令
```
perf start <id>             # 开始监控VM
perf stop <id>              # 停止监控VM
perf report                 # 显示性能报告
```

## 测试示例

### 1. 基本VM操作测试
```
> vm create x86 test_payload.bin
> vm list
> vm start 1
> vm run 1 5
> vm info 1
> vm stop 1
```

### 2. 调度器集成测试
```
> sched start
> sched add 1 10
> sched stats
> sched stop
```

### 3. 性能监控测试
```
> perf start 1
> vm run 1 10
> perf stop 1
> perf report
```

## Payload文件格式

系统支持任意二进制格式的payload文件。测试时可以使用提供的Python脚本生成测试文件：

```bash
python generate_test_payload.py
```

这将生成以下测试文件：
- `x86_test.bin` - x86架构测试payload
- `arm_test.bin` - ARM架构测试payload  
- `x64_test.bin` - x64架构测试payload

## 注意事项

1. **文件路径**：payload文件路径支持相对路径和绝对路径
2. **架构兼容性**：目前调度器仅支持x86 VM，ARM和x64 VM只能单独运行
3. **资源管理**：建议及时停止不需要的VM以释放系统资源
4. **核心绑定**：核心绑定功能需要系统支持CPU亲和性设置

## 错误处理

终端会对常见错误进行提示：
- 文件不存在或无法访问
- VM ID不存在
- 无效的命令参数
- 系统资源不足

遇到错误时，请根据提示信息检查相应的配置和参数。

## 扩展功能

控制台终端设计具有良好的扩展性，可以轻松添加：
- 更多VM架构支持
- 高级调试功能
- 批处理脚本执行
- 图形化界面支持